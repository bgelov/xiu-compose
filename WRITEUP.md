# Задача 1
## Описание задачи
Необходимо реализовать rtmp-кластер на базе https://github.com/harlanc/xiu.git стрим-сервера из 3 инстансов:

Реализация кластера для проверки функционала в локальной среде, используя docker-compose.

Успешным результатом будет являться:
- Наличие rtmp потока у всех членов кластера
- Просмотр потока в httpflv и hls с каждого члена кластера
- Срок выполнения 2 дня
- Решение предоставить в виде архива petrov-stage1-1685933169-1685933170.tar.xz (где timestamp - время получения и сдачи задания). И предоставить writeup с описанием решения WRITEUP.md в архиве.

## Требования к реализации
- Реализовать сборку артефакта и запуск в несколько стадий. В качестве раннера использовать alpine.
- Для запуска по-умолчанию использовать toml конфиг application/xiu/src/config/config_rtmp.toml для тестирования сборки.
- Опубликовать контейнер в registry(например hub.docker.com). Формат имени контейнера <timestamp когда было получено задание>-<md5 хеш от Dockerfile>, версия 1.0.0.
- Для подачи и просмотра потоков использовать ffmpeg и ffplay. Семплы можно взять тут https://sample-videos.com/

# Описание решения
## Сборка образа
Согласно требованиям, необходимо использовать multi-stage, собирать приложение в одном контйнере и копировать исполняемые файлы в другой контейнер с Alpine.
Проект xiu написан на Rust, следовательно, для сборки оптимально использовать образ из ...

Пишем Dockerfile.
- необходимо добавить toml конфиг для запуска по-умолчанию
COPY --from=builder /xiu/application/xiu/src/config/config_rtmp.toml /etc/xiu/config_rtmp.toml
```

```

Собираем образ:
```
docker image build -t bgelov/xiu:1.0.0 .
```

Публикуем образ в registry:
```

```

### Тестирование образа

Пробуем запустить контейнер:
```
docker run -d -p 1935:1935 --name xiu bgelov/xiu:1.0.0
```

Проверяем, что контейнер запущен и смотрим на логи:
```

```

Тестируем работу с использованием ffmpeg и ffplay.
Для трансляции запускаем ffmpeg:
```
ffmpeg -re -stream_loop -1 -i big_buck_bunny_720p_30mb.mp4 -c:a copy -c:v copy -f flv -flvflags no_duration_filesize rtmp://127.0.0.1:1935/live/test
```
Для просмотра запускаем ffmpeg:
```
ffplay -i rtmp://localhost:1935/live/test
```

## Реализуем кластер
Необходимо реализовать rtmp-кластер из 3 инстансов, используя docker compose.
В xiu можно реализовать кластер путём push и pull.
Пишем конфигурацию для мастер ноды:
```

```

И пишем конфигурацию для остальных нод:
```

```

Пишем docker compose файл:
```

```

Тестируем работоспособность кластера. Успешным результатом считаем:
- Наличие rtmp потока у всех членов кластера
- Просмотр потока в httpflv и hls с каждого члена кластера

